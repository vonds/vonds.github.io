<!-- lab130.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="exit_0 Documentation" />
    <meta name="name" content="Vonds" />

    <title>Vonds | Lab 130</title>

    <!-- Favicons -->
    <link rel="shortcut icon" href="../assets/images/favicon.png" />
    <link rel="apple-touch-icon" href="../assets/images/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="../assets/images/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="../assets/images/apple-touch-icon-114x114.png" />

    <!-- Site styles (your existing) -->
    <link href="../assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../assets/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../assets/css/linea-icons.css" rel="stylesheet" />
    <link href="../assets/css/ionicons.min.css" rel="stylesheet" />
    <link href="../assets/css/simpletextrotator.css" rel="stylesheet" />
    <link href="../assets/css/magnific-popup.css" rel="stylesheet" />
    <link href="../assets/css/owl.carousel.css" rel="stylesheet" />
    <link href="../assets/css/superslides.css" rel="stylesheet" />
    <link href="../assets/css/vertical.css" rel="stylesheet" />
    <link href="../assets/css/animate.css" rel="stylesheet" />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <link href="../assets/css/docs.css" rel="stylesheet" />

    <!-- Lab page styles -->
    <link href="../assets/css/lab.css" rel="stylesheet" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Dosis" rel="stylesheet" />
  </head>

  <body>
    <!-- PRELOADER -->
    <div class="page-loader">
      <div class="loader">Loading...</div>
    </div>

    <!-- OVERLAY MENU -->
    <div id="overlay-menu" class="overlay-menu">
      <a href="#" id="overlay-menu-hide" class="navigation-hide">
        <i class="ion-close-round"></i>
      </a>

      <div class="overlay-menu-inner">
        <nav class="overlay-menu-nav">
          <ul id="nav">
            <li><a href="../index.html">Home</a></li>

            <li class="slidedown">
              <a href="#">Portfolio</a>
              <ul>
                <li>
                  <a href="https://github.com/vonds/exit_0" target="_blank" rel="noopener">
                    exit_0
                  </a>
                </li>
                <li>
                  <a href="docs.html" target="_blank" rel="noopener">
                    exit_0 Documentation
                  </a>
                </li>
                <li>
                  <a href="https://github.com/vonds/sentinel" target="_blank" rel="noopener">
                    Sentinel
                  </a>
                </li>
              </ul>
            </li>

            <li>
              <a href="https://www.linkedin.com/in/vonds/" target="_blank" rel="noopener">
                LinkedIn
              </a>
            </li>
            <li>
              <a href="https://github.com/vonds" target="_blank" rel="noopener">
                Github
              </a>
            </li>
            <li>
              <a href="mailto:vonds13@gmail.com?subject=Hello Vonds">Contact</a>
            </li>
          </ul>
        </nav>
      </div>

      <div class="overlay-navigation-footer">
        <div class="container">
          <div class="row">
            <div class="col-sm-12 text-center">
              <p class="copyright font-alt m-b-0">
                VONDS &copy;
                <script>
                  document.write(new Date().getFullYear())
                </script>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- WRAPPER -->
    <div class="wrapper">
      <!-- NAVIGATION -->
      <nav class="navbar navbar-custom navbar-transparent navbar-light navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <a class="navbar-brand" href="../index.html">
              <img src="../assets/images/logo-dark.png" width="95" alt="" />
            </a>
          </div>

          <ul id="icons-navbar" class="nav navbar-nav navbar-right">
            <li>
              <a href="#" id="toggle-menu" class="show-overlay" title="Menu">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <!-- DOCS PAGE -->
      <section class="module">
        <div class="container">
          <h2 class="font-alt module-title m-t-60">
            Lab 130: Networking Fundamentals — Restore Connectivity
          </h2>

          <nav class="lab-pagination">
            <a id="prev-lab" class="lab-nav-link" href="#" aria-label="Previous lab">&laquo;</a>
            <a id="next-lab" class="lab-nav-link" href="#" aria-label="Next lab">&raquo;</a>
          </nav>

          <div class="row">
            <!-- LEFT SIDEBAR -->
            <div class="col-sm-4 col-md-3 lab-sidebar">
              <div class="docs-sidebar">
                <div class="docs-widget">
                  <h5 class="widget-title">
                    <a href="./docs.html">Back to Lab Index</a>
                  </h5>
                  <ul class="docs-nav">
                    <li><a href="#scenario">Scenario</a></li>
                    <li><a href="#objective">Objective</a></li>
                    <li><a href="#concepts">Concepts</a></li>
                    <li><a href="#walkthrough">Walkthrough</a></li>
                    <li><a href="#breakpoints">Breakpoints</a></li>
                    <li><a href="#cleanup">Cleanup</a></li>
                    <li><a href="#reference">Reference</a></li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- MAIN CONTENT -->
            <div class="col-sm-8 col-md-9 lab-doc">
              <p class="m-b-20 lab-summary">
                Restore outbound connectivity and name resolution when the host can reach the gateway but cannot reach public IPs and DNS names fail.
                Confirm interface state, restore a missing default route, then correct DNS via NetworkManager and verify HTTP access.
              </p>

              <section class="lab-section" id="video" aria-label="Lab video">
                <div class="lab-video">
                  <div class="lab-video-embed text-center">
                    <iframe
                      src="https://www.youtube.com/embed/Mk6mNjlHpJo?si=QU6qmGaXI3tEXJ3W"
                      title="YouTube video player"
                      frameborder="0"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                      referrerpolicy="strict-origin-when-cross-origin"
                      allowfullscreen
                    ></iframe>
                  </div>
                </div>
              </section>

              <!-- Scenario -->
              <section class="lab-section" id="scenario">
                <div class="lab-chips" aria-label="Tags">
                  <span class="lab-chip"><span class="lab-chip-key">networking</span></span>
                  <span class="lab-chip"><span class="lab-chip-key">routing</span></span>
                  <span class="lab-chip"><span class="lab-chip-key">dns</span></span>
                  <span class="lab-chip"><span class="lab-chip-key">troubleshooting</span></span>
                  <span class="lab-chip"><span class="lab-chip-key">core</span></span>
                </div>

                <h3 class="font-alt lab-section-title m-b-40 m-t-40">Scenario</h3>

                <p>
                  A VM on a training network reports: “I can ping the gateway, but the internet is down and DNS names fail.”
                  You have console access and must confirm IP configuration, confirm routing, confirm DNS, fix the issue, and verify access to
                  <code>http://example.com</code>.
                </p>

                <div class="lab-callout">
                  <div class="lab-callout-label">Network facts</div>
                  <p class="m-b-0">
                    Interface: <code>eth0</code>. Expected gateway: <code>10.0.2.2</code>. Expected DNS server: <code>10.0.2.3</code>.
                    Test site: <code>http://example.com</code>.
                  </p>
                </div>
              </section>

              <!-- Objective -->
              <section class="lab-section alt-background" id="objective">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">Objective</h3>
                <ul>
                  <li>Confirm <code>eth0</code> is up and has an IPv4 address.</li>
                  <li>Prove reachability to the gateway <code>10.0.2.2</code>.</li>
                  <li>Inspect the routing table and detect a missing default route.</li>
                  <li>Restore the default route and verify internet reachability by IP.</li>
                  <li>Inspect resolver configuration and detect an incorrect DNS server.</li>
                  <li>Set DNS to <code>10.0.2.3</code> via NetworkManager and verify name resolution and HTTP access.</li>
                </ul>
              </section>

              <!-- Concepts -->
              <section class="lab-section" id="concepts">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">Concepts</h3>

                <p>
                  “Internet is down” is not a single failure. You isolate it in layers:
                </p>

                <ul>
                  <li><strong>Interface and IP</strong>: the NIC is up and has a correct address/prefix.</li>
                  <li><strong>Local path</strong>: you can reach the gateway (same subnet).</li>
                  <li><strong>Routing</strong>: you can reach the gateway but cannot reach public IPs because there is no default route.</li>
                  <li><strong>DNS</strong>: you can reach public IPs but hostnames fail because the resolver is wrong.</li>
                </ul>

                <div class="lab-callout">
                  <div class="lab-callout-label">Order matters</div>
                  <p class="m-b-0">
                    Always prove public IP connectivity before you chase DNS. If <code>ping 1.1.1.1</code> fails, DNS is not the root cause yet.
                  </p>
                </div>
              </section>

              <!-- Walkthrough -->
              <section class="lab-section alt-background" id="walkthrough">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">Walkthrough</h3>

                <!-- Step 1 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 1</strong>: Confirm <code>eth0</code> has an IPv4 address.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-130-1">Copy</button>
                    </div>
                    <pre><code id="cmd-130-1">ip -4 addr show eth0</code></pre>
                  </div>

                  <p>
                    If the interface has no IPv4 address, do not troubleshoot DNS yet. You need working addressing first.
                  </p>
                </div>

                <!-- Step 2 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 2</strong>: Prove the gateway is reachable.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-130-2">Copy</button>
                    </div>
                    <pre><code id="cmd-130-2">ping -c 2 10.0.2.2</code></pre>
                  </div>

                  <p>
                    This confirms local L2/L3 connectivity. If this fails, fix the local network before anything else.
                  </p>
                </div>

                <!-- Step 3 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 3</strong>: Test public IP reachability (bypass DNS).
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-130-3">Copy</button>
                    </div>
                    <pre><code id="cmd-130-3">ping -c 2 1.1.1.1</code></pre>
                  </div>

                  <p>
                    If the gateway ping works but this fails, routing is usually broken (often a missing default route).
                  </p>
                </div>

                <!-- Step 4 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 4</strong>: Inspect the routing table.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-130-4">Copy</button>
                    </div>
                    <pre><code id="cmd-130-4">ip route</code></pre>
                  </div>

                  <p>
                    You should see a line starting with <code>default via ...</code>. If it is missing, the host has no path to networks outside its subnet.
                  </p>
                </div>

                <!-- Step 5 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 5</strong>: Add the missing default route.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-130-5">Copy</button>
                    </div>
                    <pre><code id="cmd-130-5">sudo ip route add default via 10.0.2.2 dev eth0</code></pre>
                  </div>

                  <div class="lab-callout">
                    <div class="lab-callout-label">Note</div>
                    <p class="m-b-0">
                      This restores routing immediately but may not persist across reboot depending on how networking is managed.
                      The lab focuses on incident-style restore first.
                    </p>
                  </div>
                </div>

                <!-- Step 6 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 6</strong>: Re-test public IP reachability.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-130-6">Copy</button>
                    </div>
                    <pre><code id="cmd-130-6">ping -c 2 1.1.1.1</code></pre>
                  </div>

                  <p>
                    If this now works, routing is fixed. Move on to DNS.
                  </p>
                </div>

                <!-- Step 7 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 7</strong>: Inspect DNS configuration (systemd-resolved stack).
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-130-7">Copy</button>
                    </div>
                    <pre><code id="cmd-130-7">resolvectl status</code></pre>
                  </div>

                  <p>
                    Check which DNS servers are assigned to <code>eth0</code>. In this lab, the DNS server is incorrect and must be set to <code>10.0.2.3</code>.
                  </p>
                </div>

                <!-- Step 8 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 8</strong>: Find the active NetworkManager connection name for <code>eth0</code>.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-130-8">Copy</button>
                    </div>
                    <pre><code id="cmd-130-8">nmcli -t -f DEVICE,NAME con show --active | grep '^eth0:'</code></pre>
                  </div>

                  <p>
                    You will use the connection name from this output in the next steps.
                  </p>
                </div>

                <!-- Step 9 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 9</strong>: Set IPv4 DNS to <code>10.0.2.3</code> on the active connection.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-130-9">Copy</button>
                    </div>
                    <pre><code id="cmd-130-9">sudo nmcli con mod "&lt;CONNECTION_NAME&gt;" ipv4.dns "10.0.2.3"</code></pre>
                  </div>

                  <p>
                    This updates the NetworkManager profile instead of editing <code>/etc/resolv.conf</code> by hand.
                  </p>
                </div>

                <!-- Step 10 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 10</strong>: Apply the change (without reboot).
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-130-10">Copy</button>
                    </div>
                    <pre><code id="cmd-130-10">sudo nmcli con up "&lt;CONNECTION_NAME&gt;"</code></pre>
                  </div>

                  <p>
                    Bringing the connection up re-applies the profile and pushes the DNS change into the resolver stack.
                  </p>
                </div>

                <!-- Step 11 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 11</strong>: Verify name resolution and HTTP access.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-130-11">Copy</button>
                    </div>
                    <pre><code id="cmd-130-11">getent hosts example.com
curl -I http://example.com</code></pre>
                  </div>

                  <p>
                    First prove DNS resolves the name, then prove end-to-end application connectivity with an HTTP request.
                  </p>
                </div>
              </section>

              <!-- Breakpoints -->
              <section class="lab-section" id="breakpoints">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">Breakpoints</h3>

                <div class="lab-callout">
                  <div class="lab-callout-label">Gateway ping works, but 1.1.1.1 still fails after adding default route</div>
                  <p class="m-b-0">
                    The upstream device may block egress ICMP, NAT may be broken, or the VM network may be isolated. In real systems, follow up with
                    <code>traceroute</code> or <code>tracepath</code> and firewall/policy checks.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">DNS still fails after nmcli change</div>
                  <p class="m-b-0">
                    Confirm the change landed with <code>resolvectl status</code>, verify you modified the correct active connection,
                    and re-check whether the environment expects additional DNS servers or search domains.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">Route change disappears later</div>
                  <p class="m-b-0">
                    <code>ip route add</code> is runtime state. Persist it in the network manager used by the system so it survives reboot.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">Name resolution works, but HTTP fails</div>
                  <p class="m-b-0">
                    Pivot away from DNS. Check proxies, firewall egress rules, and whether HTTP is blocked while ICMP is allowed.
                  </p>
                </div>
              </section>

              <!-- Cleanup -->
              <section class="lab-section alt-background" id="cleanup">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">Cleanup checklist</h3>

                <p>
                  If you need to revert changes after the lab, remove the runtime default route you added and clear the connection DNS override.
                </p>

                <div class="lab-codeblock m-b-40 m-t-40">
                  <div class="lab-codeblock-header">
                    <span>Commands</span>
                    <button class="lab-copy-btn" type="button" data-copy="#cmd-130-cleanup">Copy</button>
                  </div>
                  <pre><code id="cmd-130-cleanup">sudo ip route del default via 10.0.2.2 dev eth0

sudo nmcli con mod "&lt;CONNECTION_NAME&gt;" ipv4.dns ""
sudo nmcli con up "&lt;CONNECTION_NAME&gt;"

ip route
resolvectl status</code></pre>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">Success signal</div>
                  <p class="m-b-0">
                    The default route matches the intended state for your environment, and DNS servers shown under <code>Link (eth0)</code> reflect the
                    active NetworkManager profile.
                  </p>
                </div>
              </section>

              <!-- Reference -->
              <section class="lab-section" id="reference">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">Reference</h3>

                <ul class="lab-reference-list">
                  <li><code>ip -4 addr show &lt;iface&gt;</code>: show IPv4 addressing and interface state.</li>
                  <li><code>ip route</code>: inspect the routing table and default route.</li>
                  <li><code>ip route add default via &lt;gw&gt; dev &lt;if&gt;</code>: add a runtime default route.</li>
                  <li><code>ip route del default via &lt;gw&gt; dev &lt;if&gt;</code>: remove a runtime default route.</li>
                  <li><code>ping -c N &lt;ip&gt;</code>: test reachability (use an IP to bypass DNS).</li>
                  <li><code>resolvectl status</code>: inspect resolver state and per-link DNS servers.</li>
                  <li><code>nmcli con show --active</code>: list active NetworkManager connections.</li>
                  <li><code>nmcli con mod "&lt;con&gt;" ipv4.dns "&lt;server&gt;"</code>: set DNS for a connection profile.</li>
                  <li><code>nmcli con up "&lt;con&gt;"</code>: re-apply a NetworkManager profile.</li>
                  <li><code>getent hosts &lt;name&gt;</code>: validate NSS name resolution.</li>
                  <li><code>curl -I &lt;url&gt;</code>: confirm HTTP connectivity by checking response headers.</li>
                  <li><code>tracepath &lt;host&gt;</code>: inspect path behavior and discover MTU/routing issues.</li>
                </ul>
              </section>
            </div>
            <!-- /main -->
          </div>
          <!-- /row -->
        </div>
        <!-- /container -->
      </section>

      <!-- FOOTER -->
      <footer class="module bg-light">
        <div class="container">
          <div class="row">
            <div class="col-sm-12">
              <ul class="social-text-links font-alt text-center m-b-20">
                <li>
                  <a href="https://github.com/vonds" target="_blank" rel="noopener">Github</a>
                </li>
                <li>
                  <a href="https://www.linkedin.com/in/vonds/" target="_blank" rel="noopener">Linkedin</a>
                </li>
              </ul>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-12">
              <p class="copyright text-center m-b-0">
                VONDS &copy; <span id="year"></span>
              </p>

              <div class="scroll-up">
                <a href="#totop"><i class="fa fa-angle-double-up"></i></a>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <!-- Javascript files (your existing) -->
    <script src="../assets/js/jquery-2.2.4.min.js"></script>
    <script src="../assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="../assets/js/jquery.superslides.min.js"></script>
    <script src="../assets/js/jquery.mb.YTPlayer.min.js"></script>
    <script src="../assets/js/jquery.magnific-popup.min.js"></script>
    <script src="../assets/js/owl.carousel.min.js"></script>
    <script src="../assets/js/jquery.simple-text-rotator.min.js"></script>
    <script src="../assets/js/imagesloaded.pkgd.js"></script>
    <script src="../assets/js/isotope.pkgd.min.js"></script>
    <script src="../assets/js/packery-mode.pkgd.min.js"></script>
    <script src="../assets/js/appear.js"></script>
    <script src="../assets/js/jquery.easing.1.3.js"></script>
    <script src="../assets/js/wow.min.js"></script>
    <script src="../assets/js/jqBootstrapValidation.js"></script>
    <script src="../assets/js/jquery.fitvids.js"></script>
    <script src="../assets/js/jquery.parallax-1.1.3.js"></script>
    <script src="../assets/js/smoothscroll.js"></script>
    <script src="../assets/js/custom.js"></script>

    <!-- Lab page JS (new) -->
    <script src="../assets/js/lab.js"></script>

    <script>
      document.getElementById("year").textContent = new Date().getFullYear()
    </script>
  </body>
</html>
