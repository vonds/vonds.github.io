<!-- lab077.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="exit_0 Documentation" />
    <meta name="name" content="Vonds" />

    <title>Vonds | Lab 077</title>

    <!-- Favicons -->
    <link rel="shortcut icon" href="../assets/images/favicon.png" />
    <link rel="apple-touch-icon" href="../assets/images/apple-touch-icon.png" />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="../assets/images/apple-touch-icon-72x72.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="../assets/images/apple-touch-icon-114x114.png"
    />

    <!-- Site styles (your existing) -->
    <link href="../assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../assets/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../assets/css/linea-icons.css" rel="stylesheet" />
    <link href="../assets/css/ionicons.min.css" rel="stylesheet" />
    <link href="../assets/css/simpletextrotator.css" rel="stylesheet" />
    <link href="../assets/css/magnific-popup.css" rel="stylesheet" />
    <link href="../assets/css/magnific-popup.css" rel="stylesheet" />
    <link href="../assets/css/owl.carousel.css" rel="stylesheet" />
    <link href="../assets/css/superslides.css" rel="stylesheet" />
    <link href="../assets/css/vertical.css" rel="stylesheet" />
    <link href="../assets/css/animate.css" rel="stylesheet" />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <link href="../assets/css/docs.css" rel="stylesheet" />

    <!-- Lab page styles -->
    <link href="../assets/css/lab.css" rel="stylesheet" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Dosis" rel="stylesheet" />
  </head>

  <body>
    <!-- PRELOADER -->
    <div class="page-loader">
      <div class="loader">Loading...</div>
    </div>

    <!-- OVERLAY MENU -->
    <div id="overlay-menu" class="overlay-menu">
      <a href="#" id="overlay-menu-hide" class="navigation-hide">
        <i class="ion-close-round"></i>
      </a>

      <div class="overlay-menu-inner">
        <nav class="overlay-menu-nav">
          <ul id="nav">
            <li><a href="../index.html">Home</a></li>

            <li class="slidedown">
              <a href="#">Portfolio</a>
              <ul>
                <li>
                  <a
                    href="https://github.com/vonds/exit_0"
                    target="_blank"
                    rel="noopener"
                  >
                    exit_0
                  </a>
                </li>
                <li>
                  <a
                    href="https://github.com/vonds/sentinel"
                    target="_blank"
                    rel="noopener"
                  >
                    Sentinel
                  </a>
                </li>
                <li>
                  <a href="docs.html" target="_blank" rel="noopener">
                    exit_0 Documentation
                  </a>
                </li>
              </ul>
            </li>

            <li>
              <a
                href="https://www.linkedin.com/in/vonds/"
                target="_blank"
                rel="noopener"
              >
                LinkedIn
              </a>
            </li>
            <li>
              <a href="https://github.com/vonds" target="_blank" rel="noopener">
                Github
              </a>
            </li>
            <li>
              <a href="mailto:vonds13@gmail.com?subject=Hello Vonds">Contact</a>
            </li>
          </ul>
        </nav>
      </div>

      <div class="overlay-navigation-footer">
        <div class="container">
          <div class="row">
            <div class="col-sm-12 text-center">
              <p class="copyright font-alt m-b-0">
                VONDS &copy;
                <script>
                  document.write(new Date().getFullYear())
                </script>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- WRAPPER -->
    <div class="wrapper">
      <!-- NAVIGATION -->
      <nav
        class="navbar navbar-custom navbar-transparent navbar-light navbar-fixed-top"
      >
        <div class="container">
          <div class="navbar-header">
            <a class="navbar-brand" href="../index.html">
              <img src="../assets/images/logo-dark.png" width="95" alt="" />
            </a>
          </div>

          <ul id="icons-navbar" class="nav navbar-nav navbar-right">
            <li>
              <a href="#" id="toggle-menu" class="show-overlay" title="Menu">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <!-- DOCS PAGE -->
      <section class="module">
        <div class="container">
          <h2 class="font-alt module-title m-t-60">
            Lab 77: Time Synchronization with chrony
          </h2>

          <nav class="lab-pagination">
            <a
              id="prev-lab"
              class="lab-nav-link"
              href="#"
              aria-label="Previous lab"
            >
              &laquo;
            </a>
            <a
              id="next-lab"
              class="lab-nav-link"
              href="#"
              aria-label="Next lab"
            >
              &raquo;
            </a>
          </nav>

          <div class="row">
            <!-- LEFT SIDEBAR -->
            <div class="col-sm-4 col-md-3 lab-sidebar">
              <div class="docs-sidebar">
                <div class="docs-widget">
                  <h5 class="widget-title">
                    <a href="./docs.html">Back to Lab Index</a>
                  </h5>
                  <ul class="docs-nav">
                    <li><a href="#scenario">Scenario</a></li>
                    <li><a href="#objective">Objective</a></li>
                    <li><a href="#concepts">Concepts</a></li>
                    <li><a href="#walkthrough">Walkthrough</a></li>
                    <li><a href="#breakpoints">Breakpoints</a></li>
                    <li><a href="#cleanup">Cleanup</a></li>
                    <li><a href="#reference">Reference</a></li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- MAIN CONTENT -->
            <div class="col-sm-8 col-md-9 lab-doc">
              <p class="m-b-20 lab-summary">
                Stabilize a host with incorrect time by installing and operating chrony tooling on a RHEL system. Validate
                upstream sources, apply an immediate correction when appropriate, and ensure <code>chronyd</code> is enabled
                and healthy across reboots.
              </p>

              <!-- Video (kept on page; removed from left panel) -->
              <section class="lab-section" id="video" aria-label="Lab video">
                <div class="lab-video">
                  <div class="lab-video-embed text-center">
                    <iframe
                      src="https://www.youtube.com/embed/XLCd50fa_ag?si=GxGVBk5omRdBFAnh"
                      title="YouTube video player"
                      frameborder="0"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                      referrerpolicy="strict-origin-when-cross-origin"
                      allowfullscreen
                    ></iframe>
                  </div>
                </div>
              </section>

              <!-- Scenario -->
              <section class="lab-section" id="scenario">
                <div class="lab-chips" aria-label="Tags">
                  <span class="lab-chip">
                    <span class="lab-chip-key">time</span>
                  </span>
                  <span class="lab-chip">
                    <span class="lab-chip-key">services</span>
                  </span>
                  <span class="lab-chip">
                    <span class="lab-chip-key">core</span>
                  </span>
                </div>

                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Scenario
                </h3>

                <p>
                  A server’s system time is incorrect and is causing operational issues such as failed TLS handshakes, log
                  timestamps that do not align across hosts, and unreliable scheduling behavior. You need to synchronize
                  time using chrony and confirm the service stays healthy across reboots.
                </p>

                <div class="lab-callout">
                  <div class="lab-callout-label">Operator context</div>
                  <p class="m-b-0">
                    Correct time is a dependency for authentication, logging, monitoring correlation, and certificate
                    validation. Treat time sync as a baseline system health requirement before deeper service-level
                    troubleshooting.
                  </p>
                </div>
              </section>

              <!-- Objective -->
              <section class="lab-section alt-background" id="objective">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Objective
                </h3>

                <ul>
                  <li>Install chrony using the system package manager.</li>
                  <li>Inspect configured time sources and synchronization state.</li>
                  <li>Force an immediate step correction when appropriate.</li>
                  <li>
                    Enable and start <code>chronyd</code> so it persists across reboots.
                  </li>
                  <li>Confirm tracking signals indicate stable synchronization.</li>
                </ul>
              </section>

              <!-- Concepts (no alt-background moving forward) -->
              <section class="lab-section" id="concepts">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Concepts
                </h3>

                <ul>
                  <li>
                    Time sync as a platform dependency: TLS validation, authentication, logs, and scheduled workloads.
                  </li>
                  <li>
                    chrony components: <code>chronyd</code> (daemon) and <code>chronyc</code> (control client).
                  </li>
                  <li>
                    Source selection and reachability: interpreting <code>chronyc sources -v</code> markers like <code>^*</code>.
                  </li>
                  <li>
                    Slew versus step: gradual correction during steady state versus a one-time correction after large drift.
                  </li>
                  <li>
                    Service persistence: enabling <code>chronyd</code> and verifying health after boot.
                  </li>
                </ul>
              </section>

              <!-- Walkthrough -->
              <section class="lab-section alt-background" id="walkthrough">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Walkthrough
                </h3>

                <!-- Step 1 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 1</strong>
                    : Install chrony.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-step-1">
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-1">sudo dnf install -y chrony</code></pre>
                  </div>

                  <p>
                    Installing chrony provides the <code>chronyd</code> daemon and the <code>chronyc</code> control utility.
                    On RHEL, chrony is the standard NTP implementation.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code>Dependencies resolved.
Install  1 Package
Installing       : chrony-4.4-1.el9.x86_64</code></pre>
                  </div>
                </div>

                <!-- Step 2 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 2</strong>
                    : Enable and start <code>chronyd</code>.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-step-2">
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-2">sudo systemctl enable --now chronyd</code></pre>
                  </div>

                  <p>
                    This ensures the daemon starts immediately and persists across reboots. Starting the service also
                    triggers an initial sync attempt once sources are reachable.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code>Created symlink /etc/systemd/system/multi-user.target.wants/chronyd.service → /usr/lib/systemd/system/chronyd.service.
Job for chronyd.service started successfully.</code></pre>
                  </div>
                </div>

                <!-- Step 3 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 3</strong>
                    : Query current time sources.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-step-3">
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-3">chronyc sources -v</code></pre>
                  </div>

                  <p>
                    This shows configured sources and whether the host is synchronized. Look for <code>^*</code> as the
                    selected source and confirm the reach register is non-zero.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code>MS Name/IP address         Stratum Poll Reach LastRx Last sample
^* time.cloudflare.com          3   6   377    32   -0.000123   0.000345
^+ 0.rhel.pool.ntp.org          2   6   377    58   -0.000456   0.000789</code></pre>
                  </div>
                </div>

                <!-- Step 4 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 4</strong>
                    : Force an immediate correction when the clock is significantly wrong.
                  </div>

                  <div class="lab-callout">
                    <div class="lab-callout-label">Safety note</div>
                    <p class="m-b-0">
                      Stepping time can disrupt time-sensitive workloads. Use <code>makestep</code> when the clock is
                      substantially wrong (for example after a VM restore), and prefer normal steady-state synchronization
                      for routine drift.
                    </p>
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-step-4">
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-4">sudo chronyc makestep</code></pre>
                  </div>

                  <p>
                    This requests an immediate correction rather than waiting for small gradual adjustments to converge.
                    Use it sparingly and only when you understand the blast radius.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code>200 OK
makestep: adjusted offset by 0.000456 seconds</code></pre>
                  </div>
                </div>

                <!-- Step 5 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 5</strong>
                    : Confirm sync status and tracking signals.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Commands</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-step-5">
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-5">chronyc tracking
chronyc sources -v</code></pre>
                  </div>

                  <p>
                    <code>tracking</code> summarizes sync behavior and offsets. Re-checking <code>sources</code> confirms
                    reachability and which upstream is selected.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code># Example signals that time sync is healthy:
# Leap status     : Normal
# System time     : ... seconds fast/slow of NTP time
# ^* indicates current selected source</code></pre>
                  </div>
                </div>
              </section>

              <!-- Common breakpoints -->
              <section class="lab-section" id="breakpoints">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Common breakpoints
                </h3>

                <div class="lab-callout">
                  <div class="lab-callout-label">
                    chronyd is running but sources show Reach 0
                  </div>
                  <p class="m-b-0">
                    The service is up, but upstream servers are not reachable. Confirm outbound UDP/123 is allowed, check DNS
                    resolution for pool hostnames, and validate that the system has network connectivity.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">
                    No selected source marker (^*) appears
                  </div>
                  <p class="m-b-0">
                    chrony may not have enough samples yet or may be rejecting sources. Wait for additional polling, then
                    re-run <code>chronyc sources -v</code> and inspect <code>chronyc tracking</code> for leap or reference
                    status signals.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">
                    Large time jump causes service disruption
                  </div>
                  <p class="m-b-0">
                    If stepping time impacts workloads, stabilize the host during a maintenance window. For systems with strict
                    time requirements, coordinate the correction with application owners and monitoring teams.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">
                    systemctl enable --now fails
                  </div>
                  <p class="m-b-0">
                    Confirm the unit name is correct (<code>chronyd</code> on RHEL) and the package is installed. If the unit
                    fails to start, review service logs with <code>journalctl -u chronyd</code>.
                  </p>
                </div>
              </section>

              <!-- Cleanup -->
              <section class="lab-section alt-background" id="cleanup">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Cleanup checklist
                </h3>

                <p>
                  This lab does not create temporary files. Your cleanup is confirming chrony remains enabled and tracking
                  remains stable after reboots.
                </p>

                <div class="lab-codeblock m-b-40 m-t-40">
                  <div class="lab-codeblock-header">
                    <span>Commands</span>
                    <button class="lab-copy-btn" type="button" data-copy="#cmd-cleanup">
                      Copy
                    </button>
                  </div>
                  <pre><code id="cmd-cleanup">systemctl is-enabled chronyd
systemctl status chronyd --no-pager
chronyc tracking
chronyc sources -v</code></pre>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">Success signal</div>
                  <p class="m-b-0">
                    <code>chronyd</code> is enabled, the service is active, and <code>chronyc sources -v</code> shows a selected
                    upstream (<code>^*</code>) with non-zero reach.
                  </p>
                </div>
              </section>

              <!-- Reference -->
              <section class="lab-section" id="reference">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Reference
                </h3>

                <ul class="lab-reference-list">
                  <li>
                    <code>dnf install -y chrony</code>
                    : Installs chrony tooling on RHEL systems.
                    <ul>
                      <li>
                        <code>-y</code>
                        : Automatically answers “yes” to prompts.
                      </li>
                    </ul>
                  </li>

                  <li>
                    <code>systemctl enable --now chronyd</code>
                    : Enables chrony at boot and starts it immediately.
                    <ul>
                      <li>
                        <code>enable</code>
                        : Configures the service to start on boot.
                      </li>
                      <li>
                        <code>--now</code>
                        : Starts the service immediately.
                      </li>
                    </ul>
                  </li>

                  <li>
                    <code>chronyc sources -v</code>
                    : Lists configured time sources and their status.
                    <ul>
                      <li>
                        <code>^*</code>
                        : Indicates the currently selected source.
                      </li>
                      <li>
                        <code>Reach</code>
                        : Octal reachability register showing recent successful polls.
                      </li>
                    </ul>
                  </li>

                  <li>
                    <code>chronyc makestep</code>
                    : Forces an immediate step correction of system time.
                  </li>

                  <li>
                    <code>chronyc tracking</code>
                    : Displays synchronization status and time offset metrics.
                  </li>

                  <li>
                    <code>journalctl -u chronyd</code>
                    : Shows service logs for chrony.
                    <ul>
                      <li>
                        <code>-u chronyd</code>
                        : Filters logs to the <code>chronyd</code> unit.
                      </li>
                    </ul>
                  </li>
                </ul>
              </section>
            </div>
            <!-- /main -->
          </div>
          <!-- /row -->
        </div>
        <!-- /container -->
      </section>

      <!-- FOOTER -->
      <footer class="module bg-light">
        <div class="container">
          <div class="row">
            <div class="col-sm-12">
              <ul class="social-text-links font-alt text-center m-b-20">
                <li>
                  <a href="https://github.com/vonds" target="_blank" rel="noopener">
                    Github
                  </a>
                </li>
                <li>
                  <a
                    href="https://www.linkedin.com/in/vonds/"
                    target="_blank"
                    rel="noopener"
                  >
                    Linkedin
                  </a>
                </li>
              </ul>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-12">
              <p class="copyright text-center m-b-0">
                VONDS &copy;
                <span id="year"></span>
              </p>

              <div class="scroll-up">
                <a href="#totop"><i class="fa fa-angle-double-up"></i></a>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <!-- Javascript files (your existing) -->
    <script src="../assets/js/jquery-2.2.4.min.js"></script>
    <script src="../assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="../assets/js/jquery.superslides.min.js"></script>
    <script src="../assets/js/jquery.mb.YTPlayer.min.js"></script>
    <script src="../assets/js/jquery.magnific-popup.min.js"></script>
    <script src="../assets/js/owl.carousel.min.js"></script>
    <script src="../assets/js/jquery.simple-text-rotator.min.js"></script>
    <script src="../assets/js/imagesloaded.pkgd.js"></script>
    <script src="../assets/js/isotope.pkgd.min.js"></script>
    <script src="../assets/js/packery-mode.pkgd.min.js"></script>
    <script src="../assets/js/appear.js"></script>
    <script src="../assets/js/jquery.easing.1.3.js"></script>
    <script src="../assets/js/wow.min.js"></script>
    <script src="../assets/js/jqBootstrapValidation.js"></script>
    <script src="../assets/js/jquery.fitvids.js"></script>
    <script src="../assets/js/jquery.parallax-1.1.3.js"></script>
    <script src="../assets/js/smoothscroll.js"></script>
    <script src="../assets/js/custom.js"></script>

    <!-- Lab page JS (new) -->
    <script src="../assets/js/lab.js"></script>

    <script>
      document.getElementById('year').textContent = new Date().getFullYear()
    </script>
  </body>
</html>
