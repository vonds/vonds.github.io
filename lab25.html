<!-- lab025.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="exit_0 Documentation" />
    <meta name="name" content="Vonds" />

    <title>Vonds | Lab 025</title>

    <!-- Favicons -->
    <link rel="shortcut icon" href="../assets/images/favicon.png" />
    <link rel="apple-touch-icon" href="../assets/images/apple-touch-icon.png" />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="../assets/images/apple-touch-icon-72x72.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="../assets/images/apple-touch-icon-114x114.png"
    />

    <!-- Site styles (your existing) -->
    <link href="../assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../assets/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../assets/css/linea-icons.css" rel="stylesheet" />
    <link href="../assets/css/ionicons.min.css" rel="stylesheet" />
    <link href="../assets/css/simpletextrotator.css" rel="stylesheet" />
    <link href="../assets/css/magnific-popup.css" rel="stylesheet" />
    <link href="../assets/css/owl.carousel.css" rel="stylesheet" />
    <link href="../assets/css/superslides.css" rel="stylesheet" />
    <link href="../assets/css/vertical.css" rel="stylesheet" />
    <link href="../assets/css/animate.css" rel="stylesheet" />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <link href="../assets/css/docs.css" rel="stylesheet" />

    <!-- Lab page styles (new) -->
    <link href="../assets/css/lab.css" rel="stylesheet" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Dosis" rel="stylesheet" />
  </head>

  <body>
    <!-- PRELOADER -->
    <div class="page-loader">
      <div class="loader">Loading...</div>
    </div>

    <!-- OVERLAY MENU -->
    <div id="overlay-menu" class="overlay-menu">
      <a href="#" id="overlay-menu-hide" class="navigation-hide">
        <i class="ion-close-round"></i>
      </a>

      <div class="overlay-menu-inner">
        <nav class="overlay-menu-nav">
          <ul id="nav">
            <li><a href="../index.html">Home</a></li>

            <li class="slidedown">
              <a href="#">Portfolio</a>
              <ul>
                <li>
                  <a href="https://github.com/vonds/exit_0" target="_blank" rel="noopener">
                    exit_0
                  </a>
                </li>
                <li>
                  <a href="docs.html" target="_blank" rel="noopener">
                    exit_0 Documentation
                  </a>
                </li>
                <li>
                  <a href="https://github.com/vonds/sentinel" target="_blank" rel="noopener">
                    Sentinel
                  </a>
                </li>
              </ul>
            </li>

            <li>
              <a href="https://www.linkedin.com/in/vonds/" target="_blank" rel="noopener">
                LinkedIn
              </a>
            </li>
            <li>
              <a href="https://github.com/vonds" target="_blank" rel="noopener">
                Github
              </a>
            </li>
            <li>
              <a href="mailto:vonds13@gmail.com?subject=Hello Vonds">Contact</a>
            </li>
          </ul>
        </nav>
      </div>

      <div class="overlay-navigation-footer">
        <div class="container">
          <div class="row">
            <div class="col-sm-12 text-center">
              <p class="copyright font-alt m-b-0">
                VONDS &copy;
                <script>
                  document.write(new Date().getFullYear())
                </script>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- WRAPPER -->
    <div class="wrapper">
      <!-- NAVIGATION -->
      <nav class="navbar navbar-custom navbar-transparent navbar-light navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <a class="navbar-brand" href="../index.html">
              <img src="../assets/images/logo-dark.png" width="95" alt="" />
            </a>
          </div>

          <ul id="icons-navbar" class="nav navbar-nav navbar-right">
            <li>
              <a href="#" id="toggle-menu" class="show-overlay" title="Menu">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <!-- DOCS PAGE -->
      <section class="module">
        <div class="container">
          <h2 class="font-alt module-title m-t-60">
            Lab 25: Diagnose Log Issues and Manage Rotation
          </h2>

          <nav class="lab-pagination">
            <a id="prev-lab" class="lab-nav-link" href="#" aria-label="Previous lab">
              &laquo;
            </a>
            <a id="next-lab" class="lab-nav-link" href="#" aria-label="Next lab">
              &raquo;
            </a>
          </nav>

          <div class="row">
            <!-- LEFT SIDEBAR -->
            <div class="col-sm-4 col-md-3 lab-sidebar">
              <div class="docs-sidebar">
                <div class="docs-widget">
                  <h5 class="widget-title">
                    <a href="./docs.html">Back to Lab Index</a>
                  </h5>
                  <ul class="docs-nav">
                    <li><a href="#scenario">Scenario</a></li>
                    <li><a href="#objective">Objective</a></li>
                    <li><a href="#concepts">Concepts</a></li>
                    <li><a href="#walkthrough">Walkthrough</a></li>
                    <li><a href="#breakpoints">Breakpoints</a></li>
                    <li><a href="#cleanup">Cleanup</a></li>
                    <li><a href="#reference">Reference</a></li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- MAIN CONTENT -->
            <div class="col-sm-8 col-md-9 lab-doc">
              <p class="m-b-20 lab-summary">
                Diagnose performance issues by interrogating system logs, then reclaim disk
                space safely by truncating oversized log files without deleting them.
                Validate and adjust log rotation policy by inspecting logrotate configuration
                and forcing a controlled rotation run.
              </p>

              <section class="lab-section" id="video" aria-label="Lab video">
                <div class="lab-video">
                  <div class="lab-video-embed text-center">
                    <iframe
                      width="560"
                      height="315"
                      src="https://www.youtube.com/embed/3EouDQJJysk?si=GzHvDhxNE8Zo_1QO"
                      title="YouTube video player"
                      frameborder="0"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                      referrerpolicy="strict-origin-when-cross-origin"
                      allowfullscreen
                    ></iframe>
                  </div>
                </div>
              </section>

              <!-- Scenario -->
              <section class="lab-section" id="scenario">
                <div class="lab-chips" aria-label="Tags">
                  <span class="lab-chip">
                    <span class="lab-chip-key">troubleshooting</span>
                  </span>
                  <span class="lab-chip">
                    <span class="lab-chip-key">services</span>
                  </span>
                  <span class="lab-chip">
                    <span class="lab-chip-key">core</span>
                  </span>
                </div>

                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Scenario
                </h3>

                <p>
                  A user reports the system is running slowly and the root filesystem is
                  close to full. You suspect a log storm or a runaway service is filling
                  <code>/var/log</code>. Your job is to watch logs live, identify a large
                  log file consuming space, reclaim storage safely, and confirm that
                  logrotate policy is in place and functioning.
                </p>

                <div class="lab-callout">
                  <div class="lab-callout-label">Operator context</div>
                  <p class="m-b-0">
                    You are fixing the immediate disk pressure without destroying evidence.
                    The goal is stabilize first, preserve data, then tune rotation.
                  </p>
                </div>
              </section>

              <!-- Objective -->
              <section class="lab-section alt-background" id="objective">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Objective
                </h3>

                <ul>
                  <li>
                    Follow system logs in real time to observe active errors and noisy services.
                  </li>
                  <li>
                    Identify oversized logs under <code>/var/log</code> and confirm disk pressure.
                  </li>
                  <li>
                    Reclaim space safely by truncating a large log file without deleting it.
                  </li>
                  <li>
                    Locate the master logrotate configuration and the directory containing per-package rules.
                  </li>
                  <li>
                    Force a manual logrotate run to validate configuration and immediate effect.
                  </li>
                </ul>
              </section>

              <!-- Concepts -->
              <section class="lab-section" id="concepts">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Concepts
                </h3>

                <ul>
                  <li>
                    Log storms are symptoms. Your first job is to identify the noisy unit, not just delete output.
                  </li>
                  <li>
                    Truncation preserves the inode, ownership, labels, and open file handles, while reclaiming space.
                  </li>
                  <li>
                    logrotate policy comes from global defaults plus per-service rules; rotations happen on schedule
                    but can be validated on demand.
                  </li>
                  <li>
                    Forcing a rotation is a controlled test: confirm the rule matches the file, the state file updates,
                    and the rotated artifacts appear where expected.
                  </li>
                </ul>
              </section>

              <!-- Walkthrough -->
              <section class="lab-section alt-background" id="walkthrough">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Walkthrough
                </h3>

                <!-- Step 1 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 1</strong>
                    : Watch system logs in real time.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-step-1">
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-1">journalctl -f</code></pre>
                  </div>

                  <p>
                    Following the journal gives you immediate evidence of what is spamming errors or
                    creating sustained load. If disk fills due to logs, the journal often shows the root
                    cause at the same time.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code id="verify-step-1">-- Logs begin at Tue 2025-07-01 09:00:00, end at Tue 2025-07-18 14:30:00 --
Jul 18 14:25:00 lab25 kernel: CPU soft lockup detected...</code></pre>
                  </div>
                </div>

                <!-- Step 2 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 2</strong>
                    : Identify large logs under <code>/var/log</code> and confirm disk pressure.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Commands</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-step-2">
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-2">df -h /
sudo du -sh /var/log/* 2&gt;/dev/null | sort -h | tail</code></pre>
                  </div>

                  <p>
                    <code>df -h</code> confirms whether the filesystem is actually under pressure.
                    <code>du</code> gives you evidence of which files or directories are consuming space.
                    Sorting and showing the largest entries gets you to the culprit fast.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code id="verify-step-2">Filesystem      Size  Used Avail Use% Mounted on
/dev/vda2        40G   39G  1.0G  98% /

5.0G    /var/log/syslog</code></pre>
                  </div>
                </div>

                <!-- Step 3 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 3</strong>
                    : Truncate an oversized log safely.
                  </div>

                  <div class="lab-callout">
                    <div class="lab-callout-label">Safety note</div>
                    <p class="m-b-0">
                      Prefer truncation over deletion. Truncation preserves file ownership, permissions,
                      SELinux labels, and open file handles while reclaiming disk space.
                    </p>
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-step-3">
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-3">sudo truncate -s 0 /var/log/syslog</code></pre>
                  </div>

                  <p>
                    <code>truncate -s 0</code> drops file contents to zero bytes without removing the file itself.
                    This is the “stabilize without destroying evidence structure” move.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code id="verify-step-3">ls -l /var/log/syslog
sudo du -sh /var/log/syslog</code></pre>
                  </div>
                </div>

                <!-- Step 4 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 4</strong>
                    : Identify the master logrotate configuration and included rules.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Commands</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-step-4">
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-4">ls -l /etc/logrotate.conf
ls -l /etc/logrotate.d</code></pre>
                  </div>

                  <p>
                    <code>/etc/logrotate.conf</code> is the entry point for rotation policy. It typically sets global defaults
                    and includes per-package rules from <code>/etc/logrotate.d</code>.
                    This is where you confirm that the relevant service has a rotation rule.
                  </p>
                </div>

                <!-- Step 5 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 5</strong>
                    : Force logrotate to run immediately.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-step-5">
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-5">sudo logrotate -f /etc/logrotate.conf</code></pre>
                  </div>

                  <p>
                    Forcing a run validates that your configuration is syntactically correct and rotations happen as intended
                    without waiting for the schedule. After the run, verify that rotated artifacts exist and that the file does not
                    immediately regrow due to an ongoing log storm.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code id="verify-step-5">sudo ls -lh /var/log | head
sudo du -sh /var/log/* 2&gt;/dev/null | sort -h | tail</code></pre>
                  </div>
                </div>
              </section>

              <!-- Breakpoints -->
              <section class="lab-section" id="breakpoints">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Breakpoints
                </h3>

                <div class="lab-callout">
                  <div class="lab-callout-label">Disk still full after truncation</div>
                  <p class="m-b-0">
                    The space may be consumed elsewhere, or the process is still writing aggressively.
                    Re-run <code>df -h</code> and re-check the largest paths under <code>/var</code>.
                    If a deleted log is still held open by a process, truncation usually helps, but confirm
                    growth rate by watching the file size for a minute.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">Log file keeps growing instantly</div>
                  <p class="m-b-0">
                    You stabilized momentarily, but the root cause is still producing output.
                    Use <code>journalctl -f</code> to identify the service and then investigate that unit.
                    Rotation is not a fix for a runaway error loop.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">logrotate -f runs but nothing rotates</div>
                  <p class="m-b-0">
                    The rule may not match the file path, the config may be in a different per-service file,
                    or the state file prevents rotation conditions from being met without <code>-f</code>.
                    Confirm the target log is covered by a rule in <code>/etc/logrotate.d</code>.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">Permission or SELinux denial during rotation</div>
                  <p class="m-b-0">
                    If rotation creates new files, permissions and contexts must be correct.
                    Investigate denials in logs and confirm the rotation rule sets ownership and modes as needed.
                  </p>
                </div>
              </section>

              <!-- Cleanup -->
              <section class="lab-section alt-background" id="cleanup">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Cleanup checklist
                </h3>

                <p>
                  This lab makes no permanent changes besides truncating a log and manually forcing rotation.
                  Your cleanup is verifying the filesystem is stable and rotation policy is discoverable and consistent.
                </p>

                <div class="lab-codeblock m-b-40 m-t-40">
                  <div class="lab-codeblock-header">
                    <span>Commands</span>
                    <button class="lab-copy-btn" type="button" data-copy="#cmd-cleanup">
                      Copy
                    </button>
                  </div>
                  <pre><code id="cmd-cleanup">df -h /
sudo du -sh /var/log/* 2&gt;/dev/null | sort -h | tail
ls -l /etc/logrotate.conf
ls -l /etc/logrotate.d</code></pre>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">Success signal</div>
                  <p class="m-b-0">
                    Root filesystem usage drops, the oversized log is no longer consuming gigabytes, and logrotate policy
                    is clearly defined under <code>/etc/logrotate.conf</code> and <code>/etc/logrotate.d</code>.
                  </p>
                </div>
              </section>

              <!-- Reference (command -> option hierarchy) -->
              <section class="lab-section" id="reference">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Reference
                </h3>

                <ul class="lab-reference-list">
                  <li>
                    <code>journalctl</code>: systemd journal viewer
                    <ul>
                      <li>
                        <code>-f</code>
                        : Follow new log entries in real time.
                      </li>
                    </ul>
                  </li>

                  <li>
                    <code>df</code>: filesystem space reporting
                    <ul>
                      <li>
                        <code>-h</code>
                        : Human-readable sizes (GiB, MiB).
                      </li>
                    </ul>
                  </li>

                  <li>
                    <code>du</code>: disk usage reporting
                    <ul>
                      <li>
                        <code>-s</code>
                        : Summarize total for each argument.
                      </li>
                      <li>
                        <code>-h</code>
                        : Human-readable sizes (GiB, MiB).
                      </li>
                    </ul>
                  </li>

                  <li>
                    <code>truncate</code>: resize a file to a specified size
                    <ul>
                      <li>
                        <code>-s 0</code>
                        : Truncate file to zero bytes (preserve inode and permissions).
                      </li>
                    </ul>
                  </li>

                  <li>
                    <code>logrotate</code> rotate, compress, and manage log files
                    <ul>
                      <li>
                        <code>-f</code>
                        : Force rotation regardless of normal conditions.
                      </li>
                    </ul>
                  </li>

                  <li>
                    <code>/etc/logrotate.conf</code>: global logrotate configuration
                  </li>

                  <li>
                    <code>/etc/logrotate.d</code>: per-service logrotate rules directory
                  </li>
                </ul>
              </section>
            </div>
            <!-- /main -->
          </div>
          <!-- /row -->

          <nav class="lab-pagination">
            <a id="prev-lab" class="lab-nav-link" href="#" aria-label="Top">
              &uArr;
            </a>
          </nav>
        </div>
        <!-- /container -->
      </section>

      <!-- FOOTER -->
      <footer class="module bg-light">
        <div class="container">
          <div class="row">
            <div class="col-sm-12">
              <ul class="social-text-links font-alt text-center m-b-20">
                <li>
                  <a href="https://github.com/vonds" target="_blank" rel="noopener">
                    Github
                  </a>
                </li>
                <li>
                  <a href="https://www.linkedin.com/in/vonds/" target="_blank" rel="noopener">
                    Linkedin
                  </a>
                </li>
              </ul>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-12">
              <p class="copyright text-center m-b-0">
                VONDS &copy;
                <span id="year"></span>
              </p>

              <div class="scroll-up">
                <a href="#totop"><i class="fa fa-angle-double-up"></i></a>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <!-- Javascript files (your existing) -->
    <script src="../assets/js/jquery-2.2.4.min.js"></script>
    <script src="../assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="../assets/js/jquery.superslides.min.js"></script>
    <script src="../assets/js/jquery.mb.YTPlayer.min.js"></script>
    <script src="../assets/js/jquery.magnific-popup.min.js"></script>
    <script src="../assets/js/owl.carousel.min.js"></script>
    <script src="../assets/js/jquery.simple-text-rotator.min.js"></script>
    <script src="../assets/js/imagesloaded.pkgd.js"></script>
    <script src="../assets/js/isotope.pkgd.min.js"></script>
    <script src="../assets/js/packery-mode.pkgd.min.js"></script>
    <script src="../assets/js/appear.js"></script>
    <script src="../assets/js/jquery.easing.1.3.js"></script>
    <script src="../assets/js/wow.min.js"></script>
    <script src="../assets/js/jqBootstrapValidation.js"></script>
    <script src="../assets/js/jquery.fitvids.js"></script>
    <script src="../assets/js/jquery.parallax-1.1.3.js"></script>
    <script src="../assets/js/smoothscroll.js"></script>
    <script src="../assets/js/custom.js"></script>

    <!-- Lab page JS (new) -->
    <script src="../assets/js/lab.js"></script>

    <script>
      document.getElementById('year').textContent = new Date().getFullYear()
    </script>
  </body>
</html>
