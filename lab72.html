<!-- lab072.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="exit_0 Documentation" />
    <meta name="name" content="Vonds" />

    <title>Vonds | Lab 072</title>

    <!-- Favicons -->
    <link rel="shortcut icon" href="../assets/images/favicon.png" />
    <link rel="apple-touch-icon" href="../assets/images/apple-touch-icon.png" />
    <link
      rel="apple-touch-icon"
      sizes="72x72"
      href="../assets/images/apple-touch-icon-72x72.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="114x114"
      href="../assets/images/apple-touch-icon-114x114.png"
    />

    <!-- Site styles (your existing) -->
    <link href="../assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../assets/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../assets/css/linea-icons.css" rel="stylesheet" />
    <link href="../assets/css/ionicons.min.css" rel="stylesheet" />
    <link href="../assets/css/simpletextrotator.css" rel="stylesheet" />
    <link href="../assets/css/magnific-popup.css" rel="stylesheet" />
    <link href="../assets/css/owl.carousel.css" rel="stylesheet" />
    <link href="../assets/css/superslides.css" rel="stylesheet" />
    <link href="../assets/css/vertical.css" rel="stylesheet" />
    <link href="../assets/css/animate.css" rel="stylesheet" />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <link href="../assets/css/docs.css" rel="stylesheet" />

    <!-- Lab page styles (new) -->
    <link href="../assets/css/lab.css" rel="stylesheet" />

    <!-- Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Dosis"
      rel="stylesheet"
    />
  </head>

  <body>
    <!-- PRELOADER -->
    <div class="page-loader">
      <div class="loader">Loading...</div>
    </div>

    <!-- OVERLAY MENU -->
    <div id="overlay-menu" class="overlay-menu">
      <a href="#" id="overlay-menu-hide" class="navigation-hide">
        <i class="ion-close-round"></i>
      </a>

      <div class="overlay-menu-inner">
        <nav class="overlay-menu-nav">
          <ul id="nav">
            <li><a href="../index.html">Home</a></li>

            <li class="slidedown">
              <a href="#">Portfolio</a>
              <ul>
                <li>
                  <a
                    href="https://github.com/vonds/exit_0"
                    target="_blank"
                    rel="noopener"
                  >
                    exit_0
                  </a>
                </li>
                <li>
                  <a href="docs.html" target="_blank" rel="noopener">
                    exit_0 Documentation
                  </a>
                </li>
                <li>
                  <a
                    href="https://github.com/vonds/sentinel"
                    target="_blank"
                    rel="noopener"
                  >
                    Sentinel
                  </a>
                </li>
              </ul>
            </li>

            <li>
              <a
                href="https://www.linkedin.com/in/vonds/"
                target="_blank"
                rel="noopener"
              >
                LinkedIn
              </a>
            </li>
            <li>
              <a href="https://github.com/vonds" target="_blank" rel="noopener">
                Github
              </a>
            </li>
            <li>
              <a href="mailto:vonds13@gmail.com?subject=Hello Vonds">Contact</a>
            </li>
          </ul>
        </nav>
      </div>

      <div class="overlay-navigation-footer">
        <div class="container">
          <div class="row">
            <div class="col-sm-12 text-center">
              <p class="copyright font-alt m-b-0">
                VONDS &copy;
                <script>
                  document.write(new Date().getFullYear())
                </script>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- WRAPPER -->
    <div class="wrapper">
      <!-- NAVIGATION -->
      <nav
        class="navbar navbar-custom navbar-transparent navbar-light navbar-fixed-top"
      >
        <div class="container">
          <div class="navbar-header">
            <a class="navbar-brand" href="../index.html">
              <img src="../assets/images/logo-dark.png" width="95" alt="" />
            </a>
          </div>

          <ul id="icons-navbar" class="nav navbar-nav navbar-right">
            <li>
              <a href="#" id="toggle-menu" class="show-overlay" title="Menu">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <!-- DOCS PAGE -->
      <section class="module">
        <div class="container">
          <h2 class="font-alt module-title m-t-60">
            Lab 72: Creating a Local Package Repository
          </h2>

          <nav class="lab-pagination">
            <a
              id="prev-lab"
              class="lab-nav-link"
              href="#"
              aria-label="Previous lab"
            >
              &laquo;
            </a>
            <a
              id="next-lab"
              class="lab-nav-link"
              href="#"
              aria-label="Next lab"
            >
              &raquo;
            </a>
          </nav>

          <div class="row">
            <!-- LEFT SIDEBAR -->
            <div class="col-sm-4 col-md-3 lab-sidebar">
              <div class="docs-sidebar">
                <div class="docs-widget">
                  <h5 class="widget-title">
                    <a href="./docs.html">Back to Lab Index</a>
                  </h5>
                  <ul class="docs-nav">
                    <li><a href="#scenario">Scenario</a></li>
                    <li><a href="#objective">Objective</a></li>
                    <li><a href="#concepts">Concepts</a></li>
                    <li><a href="#walkthrough">Walkthrough</a></li>
                    <li><a href="#breakpoints">Breakpoints</a></li>
                    <li><a href="#cleanup">Cleanup</a></li>
                    <li><a href="#reference">Reference</a></li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- MAIN CONTENT -->
            <div class="col-sm-8 col-md-9 lab-doc">
              <p class="m-b-20 lab-summary">
                Build local repositories for RPM, APT, and pacman so you can
                distribute internal packages without relying on external mirrors.
                Generate the metadata artifacts clients need to query and install
                packages like a standard repo.
              </p>

              <!-- Video (kept on page; removed from left panel) -->
              <section class="lab-section" id="video" aria-label="Lab video">
                <div class="lab-video">
                  <div class="lab-video-embed text-center">
                    <iframe
                      src="https://www.youtube.com/embed/uJk54bhaadA?si=seGSukCoMFN7ohRo"
                      title="YouTube video player"
                      frameborder="0"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                      referrerpolicy="strict-origin-when-cross-origin"
                      allowfullscreen
                    ></iframe>
                  </div>
                </div>
              </section>

              <!-- Scenario -->
              <section class="lab-section" id="scenario">
                <div class="lab-chips" aria-label="Tags">
                  <span class="lab-chip">
                    <span class="lab-chip-key">packages</span>
                  </span>
                  <span class="lab-chip">
                    <span class="lab-chip-key">repos</span>
                  </span>
                  <span class="lab-chip">
                    <span class="lab-chip-key">operations</span>
                  </span>
                </div>

                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Scenario
                </h3>

                <p>
                  You need to host and maintain local package repositories for
                  custom software. Your task is to stage packages into the right
                  directory layout and generate the metadata that RPM-based,
                  Debian-based, and Arch-based clients expect.
                </p>

                <div class="lab-callout">
                  <div class="lab-callout-label">Operator context</div>
                  <p class="m-b-0">
                    Local repos are common in locked-down environments, air-gapped
                    networks, and internal release pipelines. The job is mostly
                    “put packages in the right place” plus “generate index files
                    correctly,” then validate client behavior.
                  </p>
                </div>
              </section>

              <!-- Objective -->
              <section class="lab-section alt-background" id="objective">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Objective
                </h3>
                <ul>
                  <li>
                    Create a local RPM repo directory and populate it with
                    <code>.rpm</code> packages.
                  </li>
                  <li>
                    Generate RPM repository metadata using
                    <code>createrepo</code>.
                  </li>
                  <li>
                    Create a local APT repo directory and populate it with
                    <code>.deb</code> packages.
                  </li>
                  <li>
                    Build an APT package index using
                    <code>dpkg-scanpackages</code> and compress it to
                    <code>Packages.gz</code>.
                  </li>
                  <li>
                    Create or update a pacman repository database using
                    <code>repo-add</code>.
                  </li>
                </ul>
              </section>

              <!-- Concepts (no alt-background moving forward) -->
              <section class="lab-section" id="concepts">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Concepts
                </h3>
                <ul>
                  <li>
                    Repository “index” files are the product: clients install from
                    metadata, not from directory listings.
                  </li>
                  <li>
                    Layout matters: pick a stable path and keep packages and
                    metadata together under a predictable root.
                  </li>
                  <li>
                    Regeneration is routine: every time packages change, rebuild
                    the repo metadata and re-validate client queries.
                  </li>
                  <li>
                    Transport is separate: HTTP, file shares, and removable media
                    can all serve the same repo structure as long as clients can
                    access it.
                  </li>
                  <li>
                    Verification is mandatory: a repo that “exists” is useless if
                    clients cannot query it.
                  </li>
                </ul>
              </section>

              <!-- Walkthrough -->
              <section class="lab-section alt-background" id="walkthrough">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Walkthrough
                </h3>

                <!-- Step 1 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 1</strong>
                    : Stage RPMs in a repo directory.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button
                        class="lab-copy-btn"
                        type="button"
                        data-copy="#cmd-step-1"
                      >
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-1">mkdir -p /var/www/html/repo && cp *.rpm /var/www/html/repo</code></pre>
                  </div>

                  <p>
                    Put all RPM artifacts under a single repo root (often
                    web-served). Metadata generation assumes packages are already
                    present.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code># Confirm packages are present:
ls -1 /var/www/html/repo</code></pre>
                  </div>
                </div>

                <!-- Step 2 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 2</strong>
                    : Generate RPM repository metadata.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button
                        class="lab-copy-btn"
                        type="button"
                        data-copy="#cmd-step-2"
                      >
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-2">createrepo /var/www/html/repo</code></pre>
                  </div>

                  <p>
                    This generates <code>repodata/</code> and the metadata files
                    yum/dnf read when they query the repo.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code>Spawning worker 0 with 1 pkgs
Workers finished
Saving Primary metadata
Repo created successfully.</code></pre>
                  </div>
                </div>

                <!-- Step 3 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 3</strong>
                    : Stage Debian packages in an APT repo directory.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button
                        class="lab-copy-btn"
                        type="button"
                        data-copy="#cmd-step-3"
                      >
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-3">mkdir -p /srv/aptrepo && cp *.deb /srv/aptrepo</code></pre>
                  </div>

                  <p>
                    This stages <code>.deb</code> packages. Next you generate the
                    index file apt reads when it searches for packages.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code># Confirm packages are present:
ls -1 /srv/aptrepo</code></pre>
                  </div>
                </div>

                <!-- Step 4 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 4</strong>
                    : Build and compress the APT package index.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button
                        class="lab-copy-btn"
                        type="button"
                        data-copy="#cmd-step-4"
                      >
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-4">dpkg-scanpackages /srv/aptrepo /dev/null | gzip -9 &gt; /srv/aptrepo/Packages.gz</code></pre>
                  </div>

                  <p>
                    This produces a minimal <code>Packages</code> index and writes
                    it as <code>Packages.gz</code>, which is common for small
                    local repos.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code># Confirm the index exists:
ls -l /srv/aptrepo/Packages.gz</code></pre>
                  </div>
                </div>

                <!-- Step 5 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 5</strong>
                    : Create or update a pacman repo database.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button
                        class="lab-copy-btn"
                        type="button"
                        data-copy="#cmd-step-5"
                      >
                        Copy
                      </button>
                    </div>
                    <pre><code id="cmd-step-5">repo-add myrepo.db.tar.gz *.pkg.tar.zst</code></pre>
                  </div>

                  <p>
                    This creates or updates the pacman repository database and
                    indexes all matching packages in the current directory.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code>:: Creating 'myrepo.db.tar.gz' database...
:: Adding package 'custompkg-1.0-1-x86_64.pkg.tar.zst'
Repo index updated.</code></pre>
                  </div>
                </div>
              </section>

              <!-- Common breakpoints -->
              <section class="lab-section" id="breakpoints">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Common breakpoints
                </h3>

                <div class="lab-callout">
                  <div class="lab-callout-label">
                    createrepo succeeds but clients cannot see the repo
                  </div>
                  <p class="m-b-0">
                    Confirm the repo root is reachable over the chosen transport.
                    If you are serving over HTTP, verify the web server is
                    running, the path is correct, and the client repo file points
                    at the right URL.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">
                    Packages.gz exists but apt cannot find packages
                  </div>
                  <p class="m-b-0">
                    The client sources entry must point at the repo root and the
                    package index must be in the expected location. Validate the
                    repo path and regenerate the index after any package changes.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">
                    repo-add fails due to missing package format
                  </div>
                  <p class="m-b-0">
                    <code>repo-add</code>
                    expects Arch packages like
                    <code>*.pkg.tar.zst</code>
                    . Verify you are in the directory containing those packages
                    and the glob matches real files.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">
                    Metadata is stale after adding new packages
                  </div>
                  <p class="m-b-0">
                    Repo metadata is not automatic. Re-run the metadata generation
                    command after adding or removing packages and re-test client
                    queries.
                  </p>
                </div>
              </section>

              <!-- Cleanup -->
              <section class="lab-section alt-background" id="cleanup">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Cleanup checklist
                </h3>

                <p>
                  Remove the staged repo directories if you do not need to keep
                  them. If this is a lab VM, cleanup returns the system to a clean
                  baseline and prevents old metadata from confusing later runs.
                </p>

                <div class="lab-codeblock m-b-40 m-t-40">
                  <div class="lab-codeblock-header">
                    <span>Commands</span>
                    <button
                      class="lab-copy-btn"
                      type="button"
                      data-copy="#cmd-cleanup"
                    >
                      Copy
                    </button>
                  </div>
                  <pre><code id="cmd-cleanup">sudo rm -rf /var/www/html/repo
sudo rm -rf /srv/aptrepo
rm -f myrepo.db.tar.gz myrepo.files.tar.gz</code></pre>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">Success signal</div>
                  <p class="m-b-0">
                    Repo directories and generated index files are removed, and
                    subsequent runs start from an empty baseline.
                  </p>
                </div>
              </section>

              <!-- Reference -->
              <section class="lab-section" id="reference">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">
                  Reference
                </h3>

                <ul class="lab-reference-list">
                  <li>
                    <code>mkdir -p &lt;dir&gt;</code>
                    : Create a directory path (including parents) if it does not exist.
                    <ul>
                      <li>
                        <code>-p</code>
                        : Create parent directories as needed and do not error if the directory exists.
                      </li>
                    </ul>
                  </li>

                  <li>
                    <code>cp *.rpm &lt;dir&gt;</code>
                    : Copy RPM artifacts into a repo directory.
                    <ul>
                      <li>
                        <code>*.rpm</code>
                        : Glob matching RPM package files in the current directory.
                      </li>
                    </ul>
                  </li>

                  <li>
                    <code>createrepo &lt;repo_dir&gt;</code>
                    : Generate RPM repository metadata under <code>&lt;repo_dir&gt;/repodata/</code>.
                    <ul>
                      <li>
                        <code>repodata/</code>
                        : Metadata directory read by yum/dnf clients.
                      </li>
                    </ul>
                  </li>

                  <li>
                    <code>cp *.deb &lt;dir&gt;</code>
                    : Copy Debian packages into a repo directory.
                    <ul>
                      <li>
                        <code>*.deb</code>
                        : Glob matching Debian package files in the current directory.
                      </li>
                    </ul>
                  </li>

                  <li>
                    <code>dpkg-scanpackages &lt;dir&gt; /dev/null | gzip -9 &gt; &lt;dir&gt;/Packages.gz</code>
                    : Build and compress a minimal APT package index.
                    <ul>
                      <li>
                        <code>|</code>
                        : Pipe output from the left command into the right command.
                      </li>
                      <li>
                        <code>gzip -9</code>
                        : Compress with maximum compression.
                      </li>
                      <li>
                        <code>Packages.gz</code>
                        : Common compressed package index consumed by apt clients.
                      </li>
                    </ul>
                  </li>

                  <li>
                    <code>repo-add &lt;repo.db.tar.gz&gt; *.pkg.tar.zst</code>
                    : Create or update a pacman repository database.
                    <ul>
                      <li>
                        <code>*.pkg.tar.zst</code>
                        : Glob matching Arch package files in the current directory.
                      </li>
                      <li>
                        <code>&lt;repo.db.tar.gz&gt;</code>
                        : Repo database file read by pacman when configured as a repository.
                      </li>
                    </ul>
                  </li>

                  <li>
                    <code>rm -rf &lt;path&gt;</code>
                    : Remove files/directories recursively (dangerous).
                    <ul>
                      <li>
                        <code>-r</code>
                        : Remove directories and their contents recursively.
                      </li>
                      <li>
                        <code>-f</code>
                        : Force removal without prompting (ignore missing files).
                      </li>
                    </ul>
                  </li>
                </ul>
              </section>

              <!-- /main -->
            </div>
          </div>

          <nav class="lab-pagination">
            <a
              id="back-to-top"
              class="lab-nav-link"
              href="#"
              aria-label="Back to top"
            >
              &uArr;
            </a>
          </nav>
        </div>
      </section>

      <!-- FOOTER -->
      <footer class="module bg-light">
        <div class="container">
          <div class="row">
            <div class="col-sm-12">
              <ul class="social-text-links font-alt text-center m-b-20">
                <li>
                  <a
                    href="https://github.com/vonds"
                    target="_blank"
                    rel="noopener"
                  >
                    Github
                  </a>
                </li>
                <li>
                  <a
                    href="https://www.linkedin.com/in/vonds/"
                    target="_blank"
                    rel="noopener"
                  >
                    Linkedin
                  </a>
                </li>
              </ul>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-12">
              <p class="copyright text-center m-b-0">
                VONDS &copy;
                <span id="year"></span>
              </p>

              <div class="scroll-up">
                <a href="#totop"><i class="fa fa-angle-double-up"></i></a>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <!-- Javascript files (your existing) -->
    <script src="../assets/js/jquery-2.2.4.min.js"></script>
    <script src="../assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="../assets/js/jquery.superslides.min.js"></script>
    <script src="../assets/js/jquery.mb.YTPlayer.min.js"></script>
    <script src="../assets/js/jquery.magnific-popup.min.js"></script>
    <script src="../assets/js/owl.carousel.min.js"></script>
    <script src="../assets/js/jquery.simple-text-rotator.min.js"></script>
    <script src="../assets/js/imagesloaded.pkgd.js"></script>
    <script src="../assets/js/isotope.pkgd.min.js"></script>
    <script src="../assets/js/packery-mode.pkgd.min.js"></script>
    <script src="../assets/js/appear.js"></script>
    <script src="../assets/js/jquery.easing.1.3.js"></script>
    <script src="../assets/js/wow.min.js"></script>
    <script src="../assets/js/jqBootstrapValidation.js"></script>
    <script src="../assets/js/jquery.fitvids.js"></script>
    <script src="../assets/js/jquery.parallax-1.1.3.js"></script>
    <script src="../assets/js/smoothscroll.js"></script>
    <script src="../assets/js/custom.js"></script>

    <!-- Lab page JS (new) -->
    <script src="../assets/js/lab.js"></script>
  </body>
</html>
