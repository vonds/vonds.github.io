<!-- lab129.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="exit_0 Documentation" />
    <meta name="name" content="Vonds" />

    <title>Vonds | Lab 129</title>

    <!-- Favicons -->
    <link rel="shortcut icon" href="../assets/images/favicon.png" />
    <link rel="apple-touch-icon" href="../assets/images/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="../assets/images/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="../assets/images/apple-touch-icon-114x114.png" />

    <!-- Site styles (your existing) -->
    <link href="../assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../assets/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../assets/css/linea-icons.css" rel="stylesheet" />
    <link href="../assets/css/ionicons.min.css" rel="stylesheet" />
    <link href="../assets/css/simpletextrotator.css" rel="stylesheet" />
    <link href="../assets/css/magnific-popup.css" rel="stylesheet" />
    <link href="../assets/css/owl.carousel.css" rel="stylesheet" />
    <link href="../assets/css/superslides.css" rel="stylesheet" />
    <link href="../assets/css/vertical.css" rel="stylesheet" />
    <link href="../assets/css/animate.css" rel="stylesheet" />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <link href="../assets/css/docs.css" rel="stylesheet" />

    <!-- Lab page styles -->
    <link href="../assets/css/lab.css" rel="stylesheet" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Dosis" rel="stylesheet" />
  </head>

  <body>
    <!-- PRELOADER -->
    <div class="page-loader">
      <div class="loader">Loading...</div>
    </div>

    <!-- OVERLAY MENU -->
    <div id="overlay-menu" class="overlay-menu">
      <a href="#" id="overlay-menu-hide" class="navigation-hide">
        <i class="ion-close-round"></i>
      </a>

      <div class="overlay-menu-inner">
        <nav class="overlay-menu-nav">
          <ul id="nav">
            <li><a href="../index.html">Home</a></li>

            <li class="slidedown">
              <a href="#">Portfolio</a>
              <ul>
                <li>
                  <a href="https://github.com/vonds/exit_0" target="_blank" rel="noopener">
                    exit_0
                  </a>
                </li>
                <li>
                  <a href="docs.html" target="_blank" rel="noopener">
                    exit_0 Documentation
                  </a>
                </li>
                <li>
                  <a href="https://github.com/vonds/sentinel" target="_blank" rel="noopener">
                    Sentinel
                  </a>
                </li>
              </ul>
            </li>

            <li>
              <a href="https://www.linkedin.com/in/vonds/" target="_blank" rel="noopener">
                LinkedIn
              </a>
            </li>
            <li>
              <a href="https://github.com/vonds" target="_blank" rel="noopener">
                Github
              </a>
            </li>
            <li>
              <a href="mailto:vonds13@gmail.com?subject=Hello Vonds">Contact</a>
            </li>
          </ul>
        </nav>
      </div>

      <div class="overlay-navigation-footer">
        <div class="container">
          <div class="row">
            <div class="col-sm-12 text-center">
              <p class="copyright font-alt m-b-0">
                VONDS &copy;
                <script>
                  document.write(new Date().getFullYear())
                </script>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- WRAPPER -->
    <div class="wrapper">
      <!-- NAVIGATION -->
      <nav class="navbar navbar-custom navbar-transparent navbar-light navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <a class="navbar-brand" href="../index.html">
              <img src="../assets/images/logo-dark.png" width="95" alt="" />
            </a>
          </div>

          <ul id="icons-navbar" class="nav navbar-nav navbar-right">
            <li>
              <a href="#" id="toggle-menu" class="show-overlay" title="Menu">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <!-- DOCS PAGE -->
      <section class="module">
        <div class="container">
          <h2 class="font-alt module-title m-t-60">
            Lab 129: Fix Intermittent Connectivity (MTU)
          </h2>

          <nav class="lab-pagination">
            <a id="prev-lab" class="lab-nav-link" href="#" aria-label="Previous lab">&laquo;</a>
            <a id="next-lab" class="lab-nav-link" href="#" aria-label="Next lab">&raquo;</a>
          </nav>

          <div class="row">
            <!-- LEFT SIDEBAR -->
            <div class="col-sm-4 col-md-3 lab-sidebar">
              <div class="docs-sidebar">
                <div class="docs-widget">
                  <h5 class="widget-title">
                    <a href="./docs.html">Back to Lab Index</a>
                  </h5>
                  <ul class="docs-nav">
                    <li><a href="#scenario">Scenario</a></li>
                    <li><a href="#objective">Objective</a></li>
                    <li><a href="#concepts">Concepts</a></li>
                    <li><a href="#walkthrough">Walkthrough</a></li>
                    <li><a href="#breakpoints">Breakpoints</a></li>
                    <li><a href="#cleanup">Cleanup</a></li>
                    <li><a href="#reference">Reference</a></li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- MAIN CONTENT -->
            <div class="col-sm-8 col-md-9 lab-doc">
              <p class="m-b-20 lab-summary">
                Diagnose intermittent connectivity where small traffic succeeds but larger transfers fail due to a mismatched MTU.
                Prove the failure with a DF “large ping”, correct the MTU on <code>eth0</code>, then re-test to confirm stability.
              </p>

              <section class="lab-section" id="video" aria-label="Lab video">
                <div class="lab-video">
                  <div class="lab-video-embed text-center">
                    <iframe
                      src="https://www.youtube.com/embed/uJk54bhaadA?si=seGSukCoMFN7ohRo"
                      title="YouTube video player"
                      frameborder="0"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                      referrerpolicy="strict-origin-when-cross-origin"
                      allowfullscreen
                    ></iframe>
                  </div>
                </div>
              </section>

              <!-- Scenario -->
              <section class="lab-section" id="scenario">
                <div class="lab-chips" aria-label="Tags">
                  <span class="lab-chip"><span class="lab-chip-key">networking</span></span>
                  <span class="lab-chip"><span class="lab-chip-key">mtu</span></span>
                  <span class="lab-chip"><span class="lab-chip-key">ping</span></span>
                  <span class="lab-chip"><span class="lab-chip-key">troubleshooting</span></span>
                  <span class="lab-chip"><span class="lab-chip-key">core</span></span>
                </div>

                <h3 class="font-alt lab-section-title m-b-40 m-t-40">Scenario</h3>

                <p>
                  Users report that connections work sometimes but fail on larger transfers. Small pings succeed, but some traffic hangs or drops,
                  and you suspect a misconfigured MTU on <code>eth0</code>.
                </p>

                <div class="lab-callout">
                  <div class="lab-callout-label">Operator context</div>
                  <p class="m-b-0">
                    MTU problems often look like “random network issues” because small packets pass while larger ones fragment or blackhole.
                    Your job is to reproduce the failure, make a safe targeted change, then prove the fix with the same test.
                  </p>
                </div>
              </section>

              <!-- Objective -->
              <section class="lab-section alt-background" id="objective">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">Objective</h3>
                <ul>
                  <li>Inspect the current MTU on <code>eth0</code>.</li>
                  <li>Reproduce the failure using a “do not fragment” ping test.</li>
                  <li>Correct the MTU to <code>1500</code>.</li>
                  <li>Re-test using the same method and confirm stability.</li>
                </ul>
              </section>

              <!-- Concepts -->
              <section class="lab-section" id="concepts">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">Concepts</h3>

                <p>
                  MTU (Maximum Transmission Unit) is the largest frame size your interface will send without needing fragmentation.
                  When MTUs are mismatched along a path and ICMP “fragmentation needed” messages are blocked or ignored, you can get a blackhole:
                  small packets work, larger packets fail.
                </p>

                <ul>
                  <li><strong>Small packets succeed</strong> because they are well under the MTU.</li>
                  <li><strong>Larger transfers fail or hang</strong> because fragmentation or PMTUD is not completing cleanly.</li>
                  <li><strong>DF testing</strong> proves the problem using packet size, not guesses.</li>
                </ul>

                <div class="lab-callout">
                  <div class="lab-callout-label">Operational habit</div>
                  <p class="m-b-0">
                    Re-run the exact test that failed before you declare recovery. If you cannot reproduce the failure and then make it go away,
                    you do not really know what you fixed.
                  </p>
                </div>
              </section>

              <!-- Walkthrough -->
              <section class="lab-section alt-background" id="walkthrough">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">Walkthrough</h3>

                <!-- Step 1 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 1</strong>: Check the current MTU on <code>eth0</code>.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-129-1">Copy</button>
                    </div>
                    <pre><code id="cmd-129-1">ip link show eth0</code></pre>
                  </div>

                  <p>
                    This confirms the interface is up and shows the current MTU value. If the MTU is too low (or simply mismatched vs the network path),
                    you can see “works sometimes” behavior depending on packet size and fragmentation handling.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code># Example failure state:
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1200 qdisc fq_codel state UP mode DEFAULT group default qlen 1000</code></pre>
                  </div>
                </div>

                <!-- Step 2 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 2</strong>: Prove “large packets fail” with DF set.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-129-2">Copy</button>
                    </div>
                    <pre><code id="cmd-129-2">ping -c 1 -M do -s 1400 1.1.1.1</code></pre>
                  </div>

                  <p>
                    <code>-M do</code> sets “do not fragment.” If the packet exceeds the path MTU, the kernel refuses to send it and reports the MTU problem.
                    This is a clean way to confirm the issue without relying on application symptoms.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code>ping: local error: message too long, mtu=1200</code></pre>
                  </div>
                </div>

                <!-- Step 3 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 3</strong>: Fix the MTU on <code>eth0</code>.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-129-3">Copy</button>
                    </div>
                    <pre><code id="cmd-129-3">sudo ip link set dev eth0 mtu 1500</code></pre>
                  </div>

                  <p>
                    This applies the corrected MTU immediately. In production, you would also persist the change in your network configuration so it survives reboot.
                    The lab is incident-style: restore stable behavior first, then handle persistence as follow-up work.
                  </p>
                </div>

                <!-- Step 4 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 4</strong>: Confirm the MTU is now correct.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-129-4">Copy</button>
                    </div>
                    <pre><code id="cmd-129-4">ip link show eth0</code></pre>
                  </div>

                  <p>
                    Always re-check live interface state after making a change. This prevents you from “testing the old configuration” by mistake.
                  </p>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <pre><code>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000</code></pre>
                  </div>
                </div>

                <!-- Step 5 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 5</strong>: Re-test the same large DF ping.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-129-5">Copy</button>
                    </div>
                    <pre><code id="cmd-129-5">ping -c 1 -M do -s 1400 1.1.1.1</code></pre>
                  </div>

                  <p>
                    This is the exact test that failed earlier. If it succeeds now, you have strong evidence the MTU mismatch was the root cause.
                  </p>
                </div>

                <!-- Step 6 -->
                <div class="lab-step">
                  <div class="lab-step-title">
                    <strong class="font-alt">Step 6</strong>: Final sanity check with a normal ping.
                  </div>

                  <div class="lab-codeblock m-b-40 m-t-40">
                    <div class="lab-codeblock-header">
                      <span>Command</span>
                      <button class="lab-copy-btn" type="button" data-copy="#cmd-129-6">Copy</button>
                    </div>
                    <pre><code id="cmd-129-6">ping -c 1 1.1.1.1</code></pre>
                  </div>

                  <p>
                    A normal ping confirms baseline reachability. Combined with the DF test above, you’ve validated both “small” and “large” packet behavior.
                  </p>
                </div>
              </section>

              <!-- Breakpoints -->
              <section class="lab-section" id="breakpoints">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">Breakpoints</h3>

                <div class="lab-callout">
                  <div class="lab-callout-label">DF test doesn’t fail, but users still report hangs</div>
                  <p class="m-b-0">
                    The issue may not be MTU. Confirm the symptom is truly size-related (try multiple payload sizes) and check for packet loss,
                    duplex issues, congestion, or firewall/NAT path problems.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">Changing MTU works but does not persist</div>
                  <p class="m-b-0">
                    <code>ip link set</code> is runtime state. Persist the MTU in your network manager (NetworkManager, systemd-networkd, or distro config files)
                    so it survives reboot.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">DF test fails with a different MTU than expected</div>
                  <p class="m-b-0">
                    The bottleneck may be elsewhere in the path (tunnels, VPNs, overlays). The fix might require adjusting MTU end-to-end and ensuring PMTUD/ICMP
                    is allowed to function.
                  </p>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">You need stronger evidence than ping</div>
                  <p class="m-b-0">
                    Follow up with an application-level transfer test, and if needed, confirm the path MTU with <code>tracepath</code> or packet capture.
                  </p>
                </div>
              </section>

              <!-- Cleanup -->
              <section class="lab-section alt-background" id="cleanup">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">Cleanup checklist</h3>

                <p>
                  If you need to revert the MTU after the lab, set it back to the original value and confirm interface state.
                </p>

                <div class="lab-codeblock m-b-40 m-t-40">
                  <div class="lab-codeblock-header">
                    <span>Commands</span>
                    <button class="lab-copy-btn" type="button" data-copy="#cmd-129-cleanup">Copy</button>
                  </div>
                  <pre><code id="cmd-129-cleanup">sudo ip link set dev eth0 mtu 1200
ip link show eth0</code></pre>
                </div>

                <div class="lab-callout">
                  <div class="lab-callout-label">Success signal</div>
                  <p class="m-b-0">
                    The MTU matches the intended value on <code>eth0</code>, and your DF test behaves consistently with that configuration.
                  </p>
                </div>
              </section>

              <!-- Reference -->
              <section class="lab-section" id="reference">
                <h3 class="font-alt lab-section-title m-b-40 m-t-40">Reference</h3>

                <ul class="lab-reference-list">
                  <li><code>ip link show &lt;iface&gt;</code>: display link state, MTU, and interface flags.</li>
                  <li><code>ip link set dev &lt;iface&gt; mtu &lt;value&gt;</code>: change interface MTU at runtime.</li>
                  <li>
                    <code>ping -M do -s &lt;bytes&gt; &lt;host&gt;</code>: test packet size limits with DF behavior.
                    <ul>
                      <li><code>-M do</code>: do not fragment; fails fast if packet exceeds path MTU.</li>
                      <li><code>-s &lt;bytes&gt;</code>: ICMP payload size (headers are added on top).</li>
                      <li><code>-c 1</code>: send one packet for quick verification.</li>
                    </ul>
                  </li>
                  <li><code>tracepath &lt;host&gt;</code>: discover path MTU and hop behavior without manual sizing.</li>
                </ul>
              </section>
            </div>
            <!-- /main -->
          </div>
          <!-- /row -->
        </div>
        <!-- /container -->
      </section>

      <!-- FOOTER -->
      <footer class="module bg-light">
        <div class="container">
          <div class="row">
            <div class="col-sm-12">
              <ul class="social-text-links font-alt text-center m-b-20">
                <li>
                  <a href="https://github.com/vonds" target="_blank" rel="noopener">Github</a>
                </li>
                <li>
                  <a href="https://www.linkedin.com/in/vonds/" target="_blank" rel="noopener">Linkedin</a>
                </li>
              </ul>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-12">
              <p class="copyright text-center m-b-0">
                VONDS &copy; <span id="year"></span>
              </p>

              <div class="scroll-up">
                <a href="#totop"><i class="fa fa-angle-double-up"></i></a>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <!-- Javascript files (your existing) -->
    <script src="../assets/js/jquery-2.2.4.min.js"></script>
    <script src="../assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="../assets/js/jquery.superslides.min.js"></script>
    <script src="../assets/js/jquery.mb.YTPlayer.min.js"></script>
    <script src="../assets/js/jquery.magnific-popup.min.js"></script>
    <script src="../assets/js/owl.carousel.min.js"></script>
    <script src="../assets/js/jquery.simple-text-rotator.min.js"></script>
    <script src="../assets/js/imagesloaded.pkgd.js"></script>
    <script src="../assets/js/isotope.pkgd.min.js"></script>
    <script src="../assets/js/packery-mode.pkgd.min.js"></script>
    <script src="../assets/js/appear.js"></script>
    <script src="../assets/js/jquery.easing.1.3.js"></script>
    <script src="../assets/js/wow.min.js"></script>
    <script src="../assets/js/jqBootstrapValidation.js"></script>
    <script src="../assets/js/jquery.fitvids.js"></script>
    <script src="../assets/js/jquery.parallax-1.1.3.js"></script>
    <script src="../assets/js/smoothscroll.js"></script>
    <script src="../assets/js/custom.js"></script>

    <!-- Lab page JS (new) -->
    <script src="../assets/js/lab.js"></script>

    <script>
      document.getElementById("year").textContent = new Date().getFullYear()
    </script>
  </body>
</html>
